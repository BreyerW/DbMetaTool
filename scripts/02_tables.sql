-- Tables for pizza ordering app (Firebird 5.0)

-- Customers
CREATE TABLE CUSTOMERS (
  ID         INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME       DM_NAME,
  PHONE      DM_PHONE,
  EMAIL      DM_EMAIL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Pizzas (catalog)
CREATE TABLE PIZZAS (
  ID          INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  CODE        VARCHAR(20) CHARACTER SET UTF8 UNIQUE,
  NAME        DM_NAME,
  DESCRIPTION VARCHAR(1024) CHARACTER SET UTF8,
  PRICE       DM_PRICE,
  IS_ACTIVE   SMALLINT DEFAULT 1 -- 1 = active, 0 = inactive
);

-- Orders (header)
CREATE TABLE ORDERS (
  ID          INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  CUSTOMER_ID INTEGER NOT NULL,
  ORDER_DATE  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  TOTAL_PRICE DECIMAL(12,2) DEFAULT 0.00,
  STATUS      DM_STATUS,
  CONSTRAINT FK_ORDERS_CUSTOMER FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(ID)
);

-- Order items (lines)
CREATE TABLE ORDER_ITEMS (
  ID         INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ORDER_ID   INTEGER NOT NULL,
  PIZZA_ID   INTEGER NOT NULL,
  QUANTITY   DM_QTY,
  UNIT_PRICE DM_PRICE,
  LINE_TOTAL DECIMAL(12,2) DEFAULT 0.00,
  CONSTRAINT FK_ITEMS_ORDER FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ID),
  CONSTRAINT FK_ITEMS_PIZZA  FOREIGN KEY (PIZZA_ID)  REFERENCES PIZZAS(ID)
);

-- Simple indexes for lookups
CREATE INDEX IDX_PIZZAS_CODE ON PIZZAS (CODE);
CREATE INDEX IDX_ORDERS_CUSTOMER ON ORDERS (CUSTOMER_ID);
CREATE INDEX IDX_ITEMS_ORDER ON ORDER_ITEMS (ORDER_ID);